{% extends 'users/base.html' %}
{% load widget_tweaks %}

{% block title %}Program Director Dashboard - KHCC Graduate Medical Education{% endblock %}

{% block content %}
<h2 class="mb-4">Program Director Dashboard</h2>

<div class="dashboard-stats">
    <div class="row">
        <div class="col-md-4">
            <div class="stat-card">
                <i class="fas fa-user-md"></i>
                <div class="stat-value">{{ program.name }}</div>
                <div class="stat-label">{{ program.get_program_type_display }} Program</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <i class="fas fa-file-alt"></i>
                <div class="stat-value">{{ applications.count }}</div>
                <div class="stat-label">Total Applications</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <div class="stat-value">{{ interviewed_applications.count }}</div>
                <div class="stat-label">Interviewed Applicants</div>
            </div>
        </div>
    </div>
</div>

<ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="applications-tab" data-bs-toggle="tab" data-bs-target="#applications" type="button" role="tab" aria-controls="applications" aria-selected="true">
            <i class="fas fa-file-alt me-2"></i>All Applications
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="interviewed-tab" data-bs-toggle="tab" data-bs-target="#interviewed" type="button" role="tab" aria-controls="interviewed" aria-selected="false">
            <i class="fas fa-check-circle me-2"></i>Interviewed Applicants
        </button>
    </li>
</ul>

<div class="tab-content" id="dashboardTabContent">
    <!-- All Applications Tab -->
    <div class="tab-pane fade show active" id="applications" role="tabpanel" aria-labelledby="applications-tab">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-primary">
                    <tr>
                        <th>Applicant</th>
                        <th>University</th>
                        <th>GPA</th>
                        <th>Status</th>
                        <th>Interview Status</th>
                        <th>Average Score</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in applications %}
                        <tr>
                            <td>{{ application.applicant.username }}</td>
                            <td>{{ application.university_name }}</td>
                            <td>{{ application.get_gpa_display }}</td>
                            <td>
                                <span class="badge {% if application.status == 'DRAFT' %}bg-warning{% elif application.status == 'SUBMITTED' %}bg-secondary{% elif application.status == 'ELIGIBLE' %}bg-success{% elif application.status == 'NOT_ELIGIBLE' %}bg-danger{% elif application.status == 'APPROVED' %}bg-primary{% elif application.status == 'REJECTED' %}bg-dark{% elif application.status == 'INVITED_FOR_INTERVIEW' %}bg-info{% endif %}">
                                    {{ application.get_status_display }}
                                </span>
                            </td>
                            <td>
                                {% if application.interviews.exists %}
                                    <span class="badge bg-success">Interviewed</span>
                                {% else %}
                                    <span class="badge bg-secondary">Not Interviewed</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if application.interviews.exists %}
                                    {{ application.get_average_score|floatformat:2 }}/100
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if application.interviews.exists %}
                                    <a href="{% url 'view_interview_results' application.id %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye me-1"></i>View & Submit Score
                                    </a>
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7" class="text-center">No applications found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Interviewed Applicants Tab -->
    <div class="tab-pane fade" id="interviewed" role="tabpanel" aria-labelledby="interviewed-tab">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-primary">
                    <tr>
                        <th>Applicant</th>
                        <th>University</th>
                        <th>GPA</th>
                        <th>Average Score</th>
                        <th>Final Score</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in interviewed_applications %}
                        <tr>
                            <td>{{ application.applicant.username }}</td>
                            <td>{{ application.university_name }}</td>
                            <td>{{ application.get_gpa_display }}</td>
                            <td>{{ application.get_average_score|floatformat:2 }}/100</td>
                            <td>
                                {% if application.final_score_submitted %}
                                    {{ application.final_score|floatformat:2 }}/100
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge {% if application.final_score_submitted %}bg-success{% else %}bg-warning{% endif %}">
                                    {% if application.final_score_submitted %}
                                        Final Score Submitted
                                    {% else %}
                                        Pending Final Score
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <a href="{% url 'view_interview_results' application.id %}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye me-1"></i>View & Submit Score
                                </a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7" class="text-center">No interviewed applications found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %} 