{% extends 'users/base.html' %}
{% load widget_tweaks %}

{% block title %}Interview Results - KHCC Graduate Medical Education{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Interview Results for {{ application.applicant.username }}</h3>
            </div>
            <div class="card-body">
                <!-- Applicant Information -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h4>Applicant Information</h4>
                        <p><strong>Name:</strong> {{ application.applicant.username }}</p>
                        <p><strong>University:</strong> {{ application.university_name }}</p>
                        <p><strong>GPA:</strong> {{ application.get_gpa_display }}</p>
                        <p><strong>Program:</strong> {{ application.program.name }}</p>
                    </div>
                    <div class="col-md-6">
                        <h4>Score Summary</h4>
                        <p><strong>Average Score:</strong> {{ application.get_average_score|floatformat:2 }}/100</p>
                        <p><strong>Number of Interviews:</strong> {{ application.interviews.count }}</p>
                        {% if application.final_score_submitted %}
                            <p><strong>Final Score:</strong> {{ application.final_score|floatformat:2 }}/100</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Individual Interview Results -->
                <h4 class="mb-3">Individual Interview Results</h4>
                {% for interview in interviews %}
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Interview by {{ interview.interviewer.username }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Interview Scores</h6>
                                    <table class="table table-sm">
                                        <tr>
                                            <th>Professional Appearance:</th>
                                            <td>{{ interview.professional_appearance }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Interest:</th>
                                            <td>{{ interview.interest }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Behavior:</th>
                                            <td>{{ interview.behavior }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Future Plans:</th>
                                            <td>{{ interview.future_plans }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Personality:</th>
                                            <td>{{ interview.personality }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Handling Emergencies:</th>
                                            <td>{{ interview.handling_emergencies }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Professional Attitude:</th>
                                            <td>{{ interview.professional_attitude }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Knowledge:</th>
                                            <td>{{ interview.knowledge }}/5</td>
                                        </tr>
                                        <tr>
                                            <th>Research:</th>
                                            <td>{{ interview.research }}/{% if interview.form_type == 'RESIDENCY' %}5{% else %}10{% endif %}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6>Additional Scores</h6>
                                    <table class="table table-sm">
                                        <tr>
                                            <th>Test Score:</th>
                                            <td>{{ interview.test_score }}/{% if interview.form_type == 'RESIDENCY' %}75{% else %}40{% endif %}</td>
                                        </tr>
                                        <tr>
                                            <th>Medical School Score:</th>
                                            <td>{{ interview.medical_school_score }}/10</td>
                                        </tr>
                                        <tr>
                                            <th>Total Score:</th>
                                            <td>{{ interview.get_total_score }}/100</td>
                                        </tr>
                                    </table>
                                    {% if interview.form_type == 'FELLOWSHIP' and interview.tentative_available_date %}
                                        <p><strong>Tentative Available Date:</strong> {{ interview.tentative_available_date|date:"M d, Y" }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="alert alert-info">
                        No interview results available yet.
                    </div>
                {% endfor %}

                <!-- Final Score Form -->
                {% if not application.final_score_submitted %}
                    <div class="mt-4">
                        <h4>Submit Final Score</h4>
                        <form method="post" action="{% url 'submit_final_score' application.id %}">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="final_score">Final Score (0-100)</label>
                                        <input type="number" name="final_score" id="final_score" class="form-control" min="0" max="100" step="0.01" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="notes">Notes (Optional)</label>
                                        <textarea name="notes" id="notes" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-check me-1"></i>Submit Final Score
                                </button>
                            </div>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 